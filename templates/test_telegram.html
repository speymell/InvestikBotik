<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Telegram Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .info {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç Telegram Web App</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        
        function addResult(title, content, type = 'info') {
            const div = document.createElement('div');
            div.className = `info ${type}`;
            div.innerHTML = `<h3>${title}</h3><pre>${content}</pre>`;
            results.appendChild(div);
        }
        
        // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Telegram
        if (window.Telegram) {
            addResult('‚úÖ –¢–µ—Å—Ç 1: window.Telegram', '–û–±—ä–µ–∫—Ç Telegram –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
        } else {
            addResult('‚ùå –¢–µ—Å—Ç 1: window.Telegram', '–û–±—ä–µ–∫—Ç Telegram –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
        }
        
        // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            addResult('‚úÖ –¢–µ—Å—Ç 2: Telegram.WebApp', 'WebApp –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
            
            const tg = window.Telegram.WebApp;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            tg.ready();
            tg.expand();
            addResult('‚úÖ –¢–µ—Å—Ç 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è', 'ready() –∏ expand() –≤—ã–∑–≤–∞–Ω—ã', 'success');
            
            // –¢–µ—Å—Ç 3: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            const info = {
                version: tg.version,
                platform: tg.platform,
                colorScheme: tg.colorScheme,
                isExpanded: tg.isExpanded,
                viewportHeight: tg.viewportHeight,
                initDataAvailable: !!tg.initData,
                initDataUnsafeAvailable: !!tg.initDataUnsafe
            };
            addResult('üìä –¢–µ—Å—Ç 4: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', JSON.stringify(info, null, 2), 'info');
            
            // –¢–µ—Å—Ç 4: initData
            if (tg.initData) {
                addResult('‚úÖ –¢–µ—Å—Ç 5: initData', tg.initData, 'success');
            } else {
                addResult('‚ùå –¢–µ—Å—Ç 5: initData', 'initData –ø—É—Å—Ç–æ–π!', 'error');
            }
            
            // –¢–µ—Å—Ç 5: initDataUnsafe
            if (tg.initDataUnsafe && Object.keys(tg.initDataUnsafe).length > 0) {
                addResult('‚úÖ –¢–µ—Å—Ç 6: initDataUnsafe', JSON.stringify(tg.initDataUnsafe, null, 2), 'success');
                
                // –¢–µ—Å—Ç 6: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (tg.initDataUnsafe.user) {
                    addResult('‚úÖ –¢–µ—Å—Ç 7: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', JSON.stringify(tg.initDataUnsafe.user, null, 2), 'success');
                } else {
                    addResult('‚ùå –¢–µ—Å—Ç 7: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', '–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç', 'error');
                }
            } else {
                addResult('‚ùå –¢–µ—Å—Ç 6: initDataUnsafe', 'initDataUnsafe –ø—É—Å—Ç–æ–π!', 'error');
            }
            
            // –¢–µ—Å—Ç 7: –ü–∞—Ä—Å–∏–Ω–≥ initData –≤—Ä—É—á–Ω—É—é
            if (tg.initData) {
                try {
                    const initData = new URLSearchParams(tg.initData);
                    const userParam = initData.get('user');
                    if (userParam) {
                        const user = JSON.parse(decodeURIComponent(userParam));
                        addResult('‚úÖ –¢–µ—Å—Ç 8: –ü–∞—Ä—Å–∏–Ω–≥ initData', JSON.stringify(user, null, 2), 'success');
                    } else {
                        addResult('‚ö†Ô∏è –¢–µ—Å—Ç 8: –ü–∞—Ä—Å–∏–Ω–≥ initData', '–ü–∞—Ä–∞–º–µ—Ç—Ä user –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ initData', 'error');
                    }
                } catch (e) {
                    addResult('‚ùå –¢–µ—Å—Ç 8: –ü–∞—Ä—Å–∏–Ω–≥ initData', `–û—à–∏–±–∫–∞: ${e.message}`, 'error');
                }
            }
            
        } else {
            addResult('‚ùå –¢–µ—Å—Ç 2: Telegram.WebApp', 'WebApp –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
        }
        
        // –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
        addResult('üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', `
1. –ï—Å–ª–∏ initData –ø—É—Å—Ç–æ–π - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –ù–ï —á–µ—Ä–µ–∑ Telegram Web App –∫–Ω–æ–ø–∫—É
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Menu Button –Ω–∞—Å—Ç—Ä–æ–µ–Ω —É @BotFather
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞, –∞ –Ω–µ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—É—é —Å—Å—ã–ª–∫—É
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /app –≤ –±–æ—Ç–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–∏
        `, 'info');
    </script>
</body>
</html>
