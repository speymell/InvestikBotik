# Исправление демо-режима

## Проблема
Кнопка "Попробовать демо" была доступна всегда, даже при входе через Telegram. После нажатия устройство запоминало демо-пользователя и не переключалось на Telegram-авторизацию.

## Решение

### 1. **Скрытие кнопки демо в Telegram** (`templates/index.html`)
- Кнопка "Попробовать демо" теперь скрывается автоматически при обнаружении Telegram Web App
- Проверка происходит на клиенте через JavaScript

### 2. **Автоматическое переключение с демо на Telegram** (`templates/layout.html`)
- Добавлен флаг `data-is-demo` в body для отслеживания демо-режима
- При обнаружении Telegram Web App и демо-пользователя происходит автоматический редирект на Telegram-авторизацию
- Используется серверный флаг `is_demo_user` для точной проверки

### 3. **Блокировка демо-входа из Telegram** (`routes.py`)
- Добавлена проверка User-Agent в `/demo_login`
- Запрещён демо-вход из Telegram Web App
- При входе через Telegram флаг `is_demo` очищается
- При демо-входе флаг `is_demo` устанавливается в `True`

### 4. **Context Processor** (`routes.py`)
- Добавлен `inject_demo_flag()` для передачи флага `is_demo_user` во все шаблоны
- Флаг доступен во всех Jinja2 шаблонах

## Результат
- ✅ Кнопка "Попробовать демо" скрыта для пользователей Telegram
- ✅ Автоматическое переключение с демо на Telegram-авторизацию
- ✅ Невозможно войти в демо-режим из Telegram Web App
- ✅ Приоритет всегда у Telegram-авторизации

## Тестирование
1. Откройте приложение в обычном браузере - кнопка "Попробовать демо" видна
2. Откройте через Telegram Web App - кнопка скрыта
3. Войдите в демо через браузер, затем откройте через Telegram - автоматически переключится на ваш Telegram аккаунт
